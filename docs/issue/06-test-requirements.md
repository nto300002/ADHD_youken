# Issue #06: ãƒ†ã‚¹ãƒˆè¦ä»¶ç®¡ç†

## æ¦‚è¦
Issueã”ã¨ã®ãƒ†ã‚¹ãƒˆè¦ä»¶ã‚’ç®¡ç†ã™ã‚‹æ–°æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã™ã€‚å˜ä½“/çµ±åˆ/E2E/ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®4ã‚¿ã‚¤ãƒ—ã®ãƒ†ã‚¹ãƒˆè¦ä»¶ã‚’å®šç¾©ã—ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†ã«ã‚ˆã‚Šå®Œäº†æ¡ä»¶ã‚’æ˜ç¢ºã«ã—ã¾ã™ã€‚

## ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
**æ–°æ©Ÿèƒ½** (Day 3-4ã§å®Ÿè£…)

## ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ

- [ ] ãƒ†ã‚¹ãƒˆè¦ä»¶CRUD APIå®Ÿè£…
  - [ ] GET `/api/issues/:id/test-requirements` - ä¸€è¦§å–å¾—
  - [ ] POST `/api/issues/:id/test-requirements` - ä½œæˆ
  - [ ] PATCH `/api/test-requirements/:id` - æ›´æ–°
  - [ ] DELETE `/api/test-requirements/:id` - å‰Šé™¤
- [ ] TestRequirementã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…
  - [ ] ãƒ†ã‚¹ãƒˆã‚¿ã‚¤ãƒ—ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤º
  - [ ] ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸
  - [ ] Given/When/Thenè¡¨ç¤º
  - [ ] ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ãƒœã‚¿ãƒ³
- [ ] Issueè©³ç´°ç”»é¢ã«ãƒ†ã‚¹ãƒˆè¦ä»¶ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ 
  - [ ] ã‚¿ã‚¤ãƒ—åˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
  - [ ] å®Œäº†ç‡è¡¨ç¤º
  - [ ] ãƒ†ã‚¹ãƒˆè¦ä»¶è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ 
- [ ] ãƒ†ã‚¹ãƒˆè¦ä»¶ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†
  - [ ] pending / passed / failed
  - [ ] Issueå®Œäº†æ¡ä»¶ãƒã‚§ãƒƒã‚¯ï¼ˆå…¨ãƒ†ã‚¹ãƒˆpassedï¼‰

## ãƒ†ã‚¹ãƒˆè¦ä»¶ï¼ˆTDDãƒ•ãƒ­ãƒ¼ï¼‰

### å˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆBackendï¼‰

#### ãƒ†ã‚¹ãƒˆ1: ãƒ†ã‚¹ãƒˆè¦ä»¶ä½œæˆ
**ãƒ•ã‚¡ã‚¤ãƒ«**: `test-requirements.test.ts`

**Given**: IssueIDã¨ ãƒ†ã‚¹ãƒˆã‚¿ã‚¤ãƒ—ã€èª¬æ˜ã€åˆæ ¼åŸºæº–ãŒé€ä¿¡ã•ã‚ŒãŸå ´åˆ  
**When**: `POST /api/issues/:id/test-requirements` ã‚’å‘¼ã³å‡ºã™  
**Then**:
- issue_test_requirementsãƒ†ãƒ¼ãƒ–ãƒ«ã«ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒä½œæˆã•ã‚Œã‚‹
- test_typeã€descriptionã€criteriaãŒæ­£ã—ãä¿å­˜ã•ã‚Œã‚‹
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒpendingã§åˆæœŸåŒ–ã•ã‚Œã‚‹

#### ãƒ†ã‚¹ãƒˆ2: ãƒ†ã‚¹ãƒˆè¦ä»¶ä¸€è¦§å–å¾—ï¼ˆã‚¿ã‚¤ãƒ—ãƒ•ã‚£ãƒ«ã‚¿ï¼‰
**ãƒ•ã‚¡ã‚¤ãƒ«**: `test-requirements.test.ts`

**Given**: ã‚ã‚‹Issueã«è¤‡æ•°ã®ãƒ†ã‚¹ãƒˆè¦ä»¶ãŒç´ä»˜ã„ã¦ã„ã‚‹å ´åˆ  
**When**: `GET /api/issues/:id/test-requirements?type=security` ã‚’å‘¼ã³å‡ºã™  
**Then**:
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¿ã‚¤ãƒ—ã®ãƒ†ã‚¹ãƒˆè¦ä»¶ã®ã¿ãŒè¿”ã•ã‚Œã‚‹
- ä»–ã®ã‚¿ã‚¤ãƒ—ã¯å«ã¾ã‚Œãªã„

#### ãƒ†ã‚¹ãƒˆ3: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
**ãƒ•ã‚¡ã‚¤ãƒ«**: `test-requirements.test.ts`

**Given**: ãƒ†ã‚¹ãƒˆè¦ä»¶ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’passedã«å¤‰æ›´ã™ã‚‹å ´åˆ  
**When**: `PATCH /api/test-requirements/:id` ã§ status: 'passed' ã‚’é€ä¿¡  
**Then**:
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒpassedã«æ›´æ–°ã•ã‚Œã‚‹
- updated_atãŒæ›´æ–°ã•ã‚Œã‚‹

#### ãƒ†ã‚¹ãƒˆ4: Issueå®Œäº†æ¡ä»¶ãƒã‚§ãƒƒã‚¯
**ãƒ•ã‚¡ã‚¤ãƒ«**: `test-requirements.test.ts`

**Given**: Issueã«5ã¤ã®ãƒ†ã‚¹ãƒˆè¦ä»¶ãŒã‚ã‚Šã€å…¨ã¦passedã®å ´åˆ  
**When**: Issueå®Œäº†ãƒã‚§ãƒƒã‚¯é–¢æ•°ã‚’å‘¼ã³å‡ºã™  
**Then**:
- trueãŒè¿”ã•ã‚Œã‚‹
- IssueãŒã‚¯ãƒ­ãƒ¼ã‚ºå¯èƒ½ã¨åˆ¤å®šã•ã‚Œã‚‹

#### ãƒ†ã‚¹ãƒˆ5: Issueå®Œäº†æ¡ä»¶ãƒã‚§ãƒƒã‚¯ï¼ˆæœªå®Œäº†ã‚ã‚Šï¼‰
**ãƒ•ã‚¡ã‚¤ãƒ«**: `test-requirements.test.ts`

**Given**: Issueã«5ã¤ã®ãƒ†ã‚¹ãƒˆè¦ä»¶ãŒã‚ã‚Šã€1ã¤ãŒpendingã®å ´åˆ  
**When**: Issueå®Œäº†ãƒã‚§ãƒƒã‚¯é–¢æ•°ã‚’å‘¼ã³å‡ºã™  
**Then**:
- falseãŒè¿”ã•ã‚Œã‚‹
- IssueãŒã‚¯ãƒ­ãƒ¼ã‚ºä¸å¯ã¨åˆ¤å®šã•ã‚Œã‚‹

### å˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆFrontendï¼‰

#### ãƒ†ã‚¹ãƒˆ6: TestRequirementã‚«ãƒ¼ãƒ‰è¡¨ç¤º
**ãƒ•ã‚¡ã‚¤ãƒ«**: `TestRequirement.test.tsx`

**Given**: ãƒ†ã‚¹ãƒˆè¦ä»¶ãƒ‡ãƒ¼ã‚¿ãŒæ¸¡ã•ã‚ŒãŸå ´åˆ  
**When**: TestRequirementã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹  
**Then**:
- ãƒ†ã‚¹ãƒˆã‚¿ã‚¤ãƒ—ã‚¢ã‚¤ã‚³ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- èª¬æ˜æ–‡ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹

#### ãƒ†ã‚¹ãƒˆ7: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´
**ãƒ•ã‚¡ã‚¤ãƒ«**: `TestRequirement.test.tsx`

**Given**: pendingã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ãƒ†ã‚¹ãƒˆè¦ä»¶ã§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´åˆ  
**When**: ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‹ã‚‰ã€Œpassedã€ã‚’é¸æŠ  
**Then**:
- onStatusChangeã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå‘¼ã°ã‚Œã‚‹
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ãŒç·‘è‰²ã®ã€Œpassedã€ã«å¤‰ã‚ã‚‹

#### ãƒ†ã‚¹ãƒˆ8: ãƒ†ã‚¹ãƒˆã‚¿ã‚¤ãƒ—ã‚¢ã‚¤ã‚³ãƒ³
**ãƒ•ã‚¡ã‚¤ãƒ«**: `TestRequirement.test.tsx`

**Given**: test_type ãŒ 'security' ã®å ´åˆ  
**When**: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹  
**Then**:
- ğŸ”’ã‚¢ã‚¤ã‚³ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- ã€Œã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆã€ãƒ©ãƒ™ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹

### çµ±åˆãƒ†ã‚¹ãƒˆ

#### ãƒ†ã‚¹ãƒˆ9: Issueå®Œäº†ãƒ•ãƒ­ãƒ¼
**ãƒ•ã‚¡ã‚¤ãƒ«**: `test-requirements.integration.test.ts`

**Given**: Issueã«3ã¤ã®ãƒ†ã‚¹ãƒˆè¦ä»¶ï¼ˆå…¨ã¦pendingï¼‰ãŒã‚ã‚‹å ´åˆ  
**When**: å…¨ã¦ã®ãƒ†ã‚¹ãƒˆè¦ä»¶ã‚’passedã«å¤‰æ›´ã™ã‚‹  
**Then**:
- Issueè©³ç´°ç”»é¢ã«ã€Œå®Œäº†å¯èƒ½ã€ãƒãƒƒã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- Issueã‚¯ãƒ­ãƒ¼ã‚ºãƒœã‚¿ãƒ³ãŒæœ‰åŠ¹ã«ãªã‚‹

#### ãƒ†ã‚¹ãƒˆ10: ãƒ†ã‚¹ãƒˆè¦ä»¶è¿½åŠ ãƒ•ãƒ­ãƒ¼
**ãƒ•ã‚¡ã‚¤ãƒ«**: `test-requirements.integration.test.ts`

**Given**: Issueè©³ç´°ç”»é¢ã§ã€Œãƒ†ã‚¹ãƒˆè¦ä»¶è¿½åŠ ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´åˆ  
**When**: ãƒ•ã‚©ãƒ¼ãƒ ã«å…¥åŠ›ã—ã¦ä¿å­˜ã™ã‚‹  
**Then**:
- æ–°ã—ã„ãƒ†ã‚¹ãƒˆè¦ä»¶ãŒä½œæˆã•ã‚Œã‚‹
- ä¸€è¦§ã«è¿½åŠ è¡¨ç¤ºã•ã‚Œã‚‹
- Issueå®Œäº†ç‡ãŒå†è¨ˆç®—ã•ã‚Œã‚‹

### E2Eãƒ†ã‚¹ãƒˆ

#### ãƒ†ã‚¹ãƒˆ11: ãƒ†ã‚¹ãƒˆè¦ä»¶ç®¡ç†ãƒ•ãƒ­ãƒ¼
**ãƒ•ã‚¡ã‚¤ãƒ«**: `test-requirements.e2e.test.ts`

**Given**: Issueè©³ç´°ç”»é¢ã‚’é–‹ã„ãŸå ´åˆ  
**When**: ãƒ†ã‚¹ãƒˆè¦ä»¶ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç¢ºèªã™ã‚‹  
**Then**:
- ã‚¿ã‚¤ãƒ—åˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆè¦ä»¶ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- å®Œäº†ç‡ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼ˆä¾‹: 3/5 - 60%ï¼‰

#### ãƒ†ã‚¹ãƒˆ12: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ãƒ•ãƒ­ãƒ¼
**ãƒ•ã‚¡ã‚¤ãƒ«**: `test-requirements.e2e.test.ts`

**Given**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆè¦ä»¶ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒpendingã®å ´åˆ  
**When**: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚’é–‹ã„ã¦ã€Œpassedã€ã‚’é¸æŠ  
**Then**:
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒå³åº§ã«æ›´æ–°ã•ã‚Œã‚‹
- å®Œäº†ç‡ãŒæ›´æ–°ã•ã‚Œã‚‹
- æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ

#### ãƒ†ã‚¹ãƒˆ13: æ¨©é™ãƒã‚§ãƒƒã‚¯ï¼ˆä»–Issueï¼‰
**ãƒ•ã‚¡ã‚¤ãƒ«**: `test-requirements.security.test.ts`

**Given**: ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®Issueã«ãƒ†ã‚¹ãƒˆè¦ä»¶ã‚’è¿½åŠ ã—ã‚ˆã†ã¨ã—ãŸå ´åˆ  
**When**: `POST /api/issues/:id/test-requirements` ã‚’å‘¼ã³å‡ºã™  
**Then**:
- 403 ForbiddenãŒè¿”ã•ã‚Œã‚‹
- ãƒ†ã‚¹ãƒˆè¦ä»¶ã¯ä½œæˆã•ã‚Œãªã„

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### Backend
- Hono
- Drizzle ORM
- Zod (ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³)

### Frontend
- React 18
- Tanstack Query

### Testing
- Jest
- React Testing Library
- MSW

## é–¢é€£APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

| ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ‘ã‚¹ | èª¬æ˜ |
|---------|------|------|
| GET | /api/issues/:id/test-requirements | ãƒ†ã‚¹ãƒˆè¦ä»¶ä¸€è¦§ |
| POST | /api/issues/:id/test-requirements | ãƒ†ã‚¹ãƒˆè¦ä»¶ä½œæˆ |
| PATCH | /api/test-requirements/:id | ãƒ†ã‚¹ãƒˆè¦ä»¶æ›´æ–° |
| DELETE | /api/test-requirements/:id | ãƒ†ã‚¹ãƒˆè¦ä»¶å‰Šé™¤ |

## ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### issue_test_requirements
```sql
CREATE TABLE issue_test_requirements (
  id TEXT PRIMARY KEY,
  issue_id TEXT NOT NULL REFERENCES issues(id) ON DELETE CASCADE,
  test_type TEXT NOT NULL CHECK(test_type IN ('unit', 'integration', 'e2e', 'security')),
  description TEXT NOT NULL,
  criteria TEXT, -- åˆæ ¼åŸºæº–
  status TEXT DEFAULT 'pending' CHECK(status IN ('pending', 'passed', 'failed')),
  created_at TEXT DEFAULT CURRENT_TIMESTAMP,
  updated_at TEXT DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_test_req_issue ON issue_test_requirements(issue_id);
CREATE INDEX idx_test_req_status ON issue_test_requirements(status);
```

## å—ã‘å…¥ã‚ŒåŸºæº–

- [ ] ãƒ†ã‚¹ãƒˆè¦ä»¶ã®CRUDæ“ä½œãŒå‹•ä½œã™ã‚‹
- [ ] ã‚¿ã‚¤ãƒ—åˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–è¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ãŒå³åº§ã«åæ˜ ã•ã‚Œã‚‹
- [ ] Issueå®Œäº†æ¡ä»¶ãƒã‚§ãƒƒã‚¯ãŒæ©Ÿèƒ½ã™ã‚‹
- [ ] å®Œäº†ç‡ãŒæ­£ã—ãè¨ˆç®—ã•ã‚Œã‚‹
- [ ] ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹ï¼ˆã‚«ãƒãƒ¬ãƒƒã‚¸80%ä»¥ä¸Šï¼‰
